<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Geco Multi-Sections Viz</title>
  <style type="text/css">
    .row {
      display: flex;
      margin: 2px;
    }

    .section {
      display: flex;
      border-radius: 15px;
    }

    .sectionA {
      background-color: lightblue;
    }

    .sectionB {
      background-color: lightpink;
    }

    .sectionC {
      background-color: lightgreen;
    }

    .control, .punch {
      display: flex;
      flex-direction: column;
      justify-content: center;
      height: 30px;
      width: 30px;
      border-radius: 15px;
      border: 1px solid black;
      text-align: center;
      margin: 2px;
    }

    .added {
      background-color: white;
    }

    .missing {
      background-color: salmon;
    }
  </style>
</head>
<body>
  <div>
    <div>
      <h2>Problem Exposition and Solution Overview/Rationale</h2>
    </div>

    <div class="course-def">
      <h2>Course Definition</h2>
      <div class="row">
        <div>
          <div>Inline</div>
          <div class="section sectionA">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
            <div class="punch">15</div>
          </div>
        </div>
        <div>
          <div>Free Order</div>
          <div class="section sectionB">
            <div class="punch">21</div>
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
          </div>
        </div>
        <div>
          <div>Inline</div>
          <div class="section sectionC">
            <div class="punch">31</div>
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h2>Control Punches</h2>
      <div>
        <div class="row">
          <div class="punch">11</div>
          <div class="punch">12</div>
          <div class="punch">21</div>
          <div class="punch">13</div>
          <div class="punch">14</div>
          <div class="punch">22</div>
          <div class="punch">23</div>
          <div class="punch">15</div>
          <div class="punch">24</div>
          <div class="punch">25</div>
          <div class="punch">40</div>
          <div class="punch">32</div>
          <div class="punch">33</div>
          <div class="punch">21</div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h3>[Step 1] greedy loose tracer: Section A Punches</h3>
      <div>
        <div class="row">
          <div class="punch sectionA">11</div>
          <div class="punch sectionA">12</div>
          <div class="punch">21</div>
          <div class="punch sectionA">13</div>
          <div class="punch sectionA">14</div>
          <div class="punch">22</div>
          <div class="punch">23</div>
          <div class="punch sectionA">15</div>
          <div class="punch">24</div>
          <div class="punch">25</div>
          <div class="punch">40</div>
          <div class="punch">32</div>
          <div class="punch">33</div>
          <div class="punch">21</div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h3>[Step 1] greedy loose tracer: Section B Punches</h3>
      <div>
        <div class="row">
          <div class="punch">11</div>
          <div class="punch">12</div>
          <div class="punch sectionB">21</div>
          <div class="punch">13</div>
          <div class="punch">14</div>
          <div class="punch sectionB">22</div>
          <div class="punch sectionB">23</div>
          <div class="punch">15</div>
          <div class="punch sectionB">24</div>
          <div class="punch sectionB">25</div>
          <div class="punch">40</div>
          <div class="punch">32</div>
          <div class="punch">33</div>
          <div class="punch sectionB">21</div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h3>[Step 1] greedy loose tracer: Section C Punches</h3>
      <div>
        <div class="row">
          <div class="punch">11</div>
          <div class="punch">12</div>
          <div class="punch">21</div>
          <div class="punch">13</div>
          <div class="punch">14</div>
          <div class="punch">22</div>
          <div class="punch">23</div>
          <div class="punch">15</div>
          <div class="punch">24</div>
          <div class="punch">25</div>
          <div class="punch">40</div>
          <div class="punch sectionC">32</div>
          <div class="punch sectionC">33</div>
          <div class="punch sectionC">21</div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h3>[Step 1] results: overlapping sections</h3>
      <div>
        <div class="row">
          <div class="section sectionA">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch added">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
            <div class="punch added">22</div>
            <div class="punch added">23</div>
            <div class="punch">15</div>
          </div>
          <div class="section">
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch">40</div>
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
        <div class="row">
          <div class="section">
            <div class="punch">11</div>
            <div class="punch">12</div>
          </div>
          <div class="section sectionB">
            <div class="punch">21</div>
            <div class="punch added">13</div>
            <div class="punch added">14</div>
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch added">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch added">40</div>
            <div class="punch added">32</div>
            <div class="punch added">33</div>
            <div class="punch">21</div>
          </div>
        </div>
        <div class="row">
          <div class="section">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch">40</div>
          </div>
          <div class="section sectionC">
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h3>[Step 2.a] split/partition punches for overlapping sections A/B</h3>
      <div>
        <div class="row">
          <div class="section sectionA">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch added">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
            <div class="punch added">22</div>
            <div class="punch added">23</div>
            <div class="punch">15</div>
          </div>
          <div class="section">
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch">40</div>
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
        <div class="row">
          <div class="section">
            <div class="punch">11</div>
            <div class="punch">12</div>
          </div>
          <div class="section sectionB">
            <div class="punch">21</div>
            <div class="punch added">13</div>
            <div class="punch added">14</div>
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch added">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch added">40</div>
            <div class="punch added">32</div>
            <div class="punch added">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>


    <div class="control-punches">
      <h4>[Step 2.a] iteration 1: section A prevails over section B so section B folds to the right</h4>
      <div>
        <div class="row">
          <div class="section sectionA">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch added">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
            <div class="punch added">22</div>
            <div class="punch added">23</div>
            <div class="punch">15</div>
          </div>
          <div class="section">
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch">40</div>
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
        <div class="row">
          <div class="section">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
          </div>
          <div class="section sectionB">
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch added">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch added">40</div>
            <div class="punch added">32</div>
            <div class="punch added">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h4>[Step 2.a] iteration 2: section B prevails over section A so section A folds to the left. No more overlap between sections A and B </h4>
      <div>
        <div class="row">
          <div class="section sectionA">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch added">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
          </div>
          <div class="section">
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch">40</div>
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
        <div class="row">
          <div class="section">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
          </div>
          <div class="section sectionB">
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch added">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch added">40</div>
            <div class="punch added">32</div>
            <div class="punch added">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h3>[Step 2.a] split/partition punches for overlapping sections B/C</h3>
      <div>
        <div class="row">
          <div class="section">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
          </div>
          <div class="section sectionB">
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch added">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch added">40</div>
            <div class="punch added">32</div>
            <div class="punch added">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
      <div>
        <div class="row">
          <div class="section">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch">40</div>
          </div>
          <div class="section sectionC">
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h4>[Step 2.a] iteration 3: section C prevails over section B so section B folds to the left. No more overlap</h4>
      <div>
        <div class="row">
          <div class="section">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
          </div>
          <div class="section sectionB">
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch added">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
          </div>
          <div class="section">
            <div class="punch">40</div>
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
      <div>
        <div class="row">
          <div class="section">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch">40</div>
          </div>
          <div class="section sectionC">
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h3>[Step 2.b] rejoin sections (no orphan punch)</h3>
      <div>
        <div class="row">
          <div class="section sectionA">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch added">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
          </div>
          <div class="section sectionB">
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch added">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch added">40</div>
          </div>
          <div class="section sectionC">
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h3>[Step 3.a] refine trace for each section</h3>
      <div>
        <div class="row">
          <div class="section sectionA">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch added">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
            <div class="punch missing">15</div>
          </div>
        </div>
      </div>
      <div>
        <div class="row">
          <div class="section">
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
          </div>
          <div class="section sectionB">
            <div class="punch missing">21</div>
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch added">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch added">40</div>
          </div>
        </div>
      </div>
      <div>
        <div class="row">
          <div class="section">
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
            <div class="punch"></div>
          </div>
          <div class="section sectionC">
            <div class="punch missing">31</div>
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>

    <div class="control-punches">
      <h3>[Step 3.b] merge traces from all sections</h3>
      <div>
        <div class="row">
          <div class="section sectionA">
            <div class="punch">11</div>
            <div class="punch">12</div>
            <div class="punch added">21</div>
            <div class="punch">13</div>
            <div class="punch">14</div>
            <div class="punch missing">15</div>
          </div>
          <div class="section sectionB">
            <div class="punch missing">21</div>
            <div class="punch">22</div>
            <div class="punch">23</div>
            <div class="punch added">15</div>
            <div class="punch">24</div>
            <div class="punch">25</div>
            <div class="punch added">40</div>
          </div>
          <div class="section sectionC">
            <div class="punch missing">31</div>
            <div class="punch">32</div>
            <div class="punch">33</div>
            <div class="punch">21</div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="chart">
    <div class="controls row"></div>
    <div class="sections row"></div>
  </div>

  <svg id="algo" width="800px" height="400px">
  </svg>

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script>
    const controls = [11, 12, 13, 14, 15, 21, 22, 23, 24, 25, 31, 32, 33, 21];
    const sections = [{
      name: 'sectionA',
      color: 'lightblue',
      start: 0,
      end: 4,
    }, {
      name: 'sectionB',
      color: 'lightpink',
      start: 5,
      end: 9,
    }, {
      name: 'sectionC',
      color: 'lightgreen',
      start: 10,
      end: 13,
    }];


    const controlNodes = d3.select('.chart .controls')
      .selectAll('div')
        .data(controls)
      .enter().append('div')
        .attr('class', 'control')
        // .style("width", function(d) { return d * 10 + "px"; })
        .text(d => d);

    const sectionNodes = d3.select('.chart .sections')
      .selectAll('div')
        .data(sections)
      .enter().append('div')
        .attr('class', 'section')
        .attr('class', d => 'section ' + d.name)
        .style('width', d => (d.end - d.start + 1) * 34 + 'px')
        .style('height', '34px')

    d3.select('#algo')
      .selectAll('line')
        .data(sections)
      .enter().append('line')
        .attr('stroke', d => d.color)
        .attr('stroke-width', '36')
        .attr('stroke-linecap', 'round')
        .attr('x1', d => d.start * 36 + 20)
        .attr('x2', d => (d.end) * 36 + 20)
        .attr('y1', 50)
        .attr('y2', 50)

    const controlNode = d3.select('#algo')
      .selectAll('g')
        .data(controls)
      .enter().append('g')
        .attr('transform', (_, i) => `translate(${i * 36},50)`);

      controlNode.append('circle')
        .attr('stroke', 'black')
        .attr('stroke-width', '1')
        .attr('fill', (d, i) => i % 3 === 0 ? 'white' : i % 5 === 0 ? 'salmon' : 'transparent')
        .attr('cx', 20)
        .attr('cy', 0)
        .attr('r', 15)

      controlNode.append('text')
        .attr('dx', 13)
        .attr('dy', 5)
        .text(d => d)


  </script>
</body>
</html>
